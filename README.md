# Тестовое задание Lexicom

---
# `Задание 1`
>Вопрос практический. Решение завернутое в докер будет преимуществом. Также в
>зачет идут любые толковые комментарии и интерпретации ручек относительно
>реализации этого сервиса. Необходимо разработать RESTful сервис с использованием Fast
>API и Redis.
---
>python == 3.10
---
Логика подключения к Redis вынесена в модуль [cache.py](utils/cache.py)

Handlers находятся в пакете [views](app/views)

Сложностей с выполнением не возникло

Был только один вопрос какой метод использовать для обновления `put` или `patch`, выбрал `patch`

Для хранения данных в редис использую `STRING`, соответственно ключ это `номер телефона`, значение по ключу - `адрес`.

Если бы полей в объекте было больше, лучше использовать `HASH`(можно, но в данном контексте - неудобно искать ключи) или
`RedisJSON module`(на мой взгляд предпочтительно)

`Для запуска надо`

- Склонировать репозиторий:
    ```bash
    git clone https://github.com/korneyka3000/some_new_task.git
    ```
- Перейти в папку проекта:
    ```bash
    cd some_new_task
    ```
- Установить удобный порт(установлен `8090`) на котором будет работать приложение в [.env](/.env)

- Запустить docker-compose file:
    ```bash
    docker compose up  # for docker compose v2
    ```
  
    ```bash
    docker-compose up  # for docker compose v1
    ```
  
---

# `Задание 2`
>Нам необходимо минимальным количеством запросов к СУБД перенести данные о статусе из
>таблицы short_names в таблицу full_names.
>
>Необходимо понимать, что на выполнение запросов / время работы скрипта нельзя тратить
>больше 10 минут. Лучшее время выполнения этого тестового задания в 2022 году - 45 секунд на
>SQL запросе.

`Пробовал несколько разных вариантов, но остановился на двух более быстрых`

- Использовал для сравнения имён в двух таблицах функцию `postgresql` - `split_part`, которая делит строку по 
разделителю, что идеально подходит для условий задачи.

- Запрос у меня отрабатывает за 3-5 сек

- Пробовал делать сравнение через регулярные выражения - получилось медленнее

  ```postgresql
  UPDATE full_names fn
  SET status = sn.status
  FROM short_names sn
  WHERE sn.names = SPLIT_PART(fn.names, '.', 1)
  ```
- Другой вариант где создаю новую таблицу, удаляю старую и переименовываю созданную.

- Тут есть очевидные недостатки - кол-во запросов, удаление старой таблицы(в новой необходимо будет создать constraints,
если они были), но по времени почти то же что в варианте 1
  ```postgresql
  CREATE TABLE new_full_names (name TEXT, status INT);
  INSERT INTO new_full_names
  SELECT fn.names, sn.status
  FROM short_names sn
  JOIN full_names fn ON sn.names = SPLIT_PART(names, '.', 1);
  DROP TABLE full_names;
  ALTER TABLE new_full_names RENAME TO full_names;
  ```

- Также пробовал создавать в postgresql свою функцию(это был новый опыт) и обновлять по 1000/10000 объектов в цикле, но
получилось сложно и не очень быстро